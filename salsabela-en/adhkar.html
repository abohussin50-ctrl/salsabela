<!doctype html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Salsabela ‚Äî Adhkar</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Amiri&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    main {
      max-width: 900px;
      margin: auto;
      position: relative;
    }
    h2 {
      color: #2a9d8f;
      text-align: center;
      margin-bottom: 1rem;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    /* üåü ÿµŸÜÿØŸàŸÇ ÿßŸÑÿ®ÿ≠ÿ´ ÿßŸÑÿ¨ÿØŸäÿØ */
    .search-container {
      position: relative;
      margin-bottom: 20px;
    }
    #searchBox {
      width: 100%;
      padding: 14px 45px 14px 14px;
      border-radius: 15px;
      border: 2px solid #2a9d8f40;
      font-family: 'Cairo', sans-serif;
      font-size: 1rem;
      background: #fff url('data:image/svg+xml;utf8,<svg fill="%232a9d8f" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41L15.5 14zM5 9.5C5 7.01 7.01 5 9.5 5S14 7.01 14 9.5 11.99 14 9.5 14 5 11.99 5 9.5z"/></svg>') no-repeat 98% center;
      background-size: 22px;
      box-shadow: 0 3px 10px rgba(42, 157, 143, 0.15);
      transition: all 0.3s ease;
    }
    #searchBox:focus {
      outline: none;
      border-color: #2a9d8f;
      box-shadow: 0 4px 12px rgba(42, 157, 143, 0.25);
      background-color: #fefefe;
    }

    .suggestions {
      position: absolute;
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
      max-height: 220px;
      overflow-y: auto;
      z-index: 1000;
      width: 100%;
      display: none;
      top: 100%;
      margin-top: 5px;
    }
    .suggestions div {
      padding: 10px 14px;
      cursor: pointer;
      transition: 0.25s;
      border-bottom: 1px solid #f2f2f2;
    }
    .suggestions div:last-child { border-bottom: none; }
    .suggestions div:hover {
      background: #e8f7f4;
      color: #2a9d8f;
    }

    .section-card {
      background: #fff;
      border-radius: 12px;
      padding: 12px 15px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
      cursor: pointer;
      transition: 0.3s;
    }
    .section-card:hover { background: #e8f7f4; }

    .zekr {
      background: #fff;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 15px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.08);
    }
    .arabic {
      font-family: 'Amiri', serif;
      font-size: 1.2rem;
      color: #000;
      direction: rtl;
      text-align: right;
      margin-bottom: 8px;
    }
    .translation {
      color: #444;
      font-size: 0.95rem;
      border-top: 1px solid #eee;
      padding-top: 6px;
    }
    .counter-btn {
      background: #2a9d8f;
      color: #fff;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      transition: 0.3s;
    }
    .counter-btn:hover { background: #24897f; }
    .counter { color: #555; margin-top: 6px; }
    .back-btn {
      display: inline-block;
      background: #2a9d8f;
      color: #fff;
      padding: 8px 14px;
      border-radius: 8px;
      text-decoration: none;
      margin-bottom: 15px;
      cursor: pointer;
      transition: 0.3s;
    }
    .back-btn:hover { background: #24897f; }
  </style>
</head>
<body>
<div id="header-holder"></div>

<script src="js/common.js"></script>

<main>
  <h2>Adhkar</h2>
  <div class="search-container">
    <input type="search" id="searchBox" placeholder="Search by Arabic or English..." autocomplete="off">
    <div id="suggestions" class="suggestions"></div>
  </div>
  <div id="content">Loading...</div>
</main>
<div id="footer-holder"></div>

<script>
let allData = [];
const content = document.getElementById("content");
const searchBox = document.getElementById("searchBox");
const suggestionBox = document.getElementById("suggestions");

function normalizeText(text) {
  return text.toLowerCase().replace(/[ŸéŸãŸèŸåŸêŸçŸíŸëŸÄÿåÿõÿü]/g, "")
  .replace(/[ÿ£ÿ•ÿ¢Ÿ±]/g,"ÿß").replace(/ÿ§/g,"Ÿà").replace(/ÿ¶/g,"Ÿä")
  .replace(/ÿ©/g,"Ÿá").replace(/Ÿâ/g,"Ÿä").replace(/[^a-zÿ°-Ÿä0-9\s]/gi," ").trim();
}

async function loadAdhkar() {
  try {
    const res = await fetch("source/husn_en.json");
    const data = await res.json();
    allData = data.English;
    renderSections();
  } catch {
    content.innerHTML = `<p style="color:red;text-align:center">‚ö†Ô∏è Error loading file.</p>`;
  }
}

function renderSections() {
  suggestionBox.style.display = "none";
  content.innerHTML = "";
  allData.forEach((sec, i) => {
    const div = document.createElement("div");
    div.className = "section-card";
    div.textContent = sec.TITLE;
    div.onclick = () => renderAdhkar(i);
    content.appendChild(div);
  });
}

function renderAdhkar(index) {
  const sec = allData[index];
  content.innerHTML = `<div class="back-btn" onclick="renderSections()">‚Üê Back</div><h2>${sec.TITLE}</h2>`;
  sec.TEXT.forEach(z => {
    const div = document.createElement("div");
    div.className = "zekr";
    div.innerHTML = `
      <div class="arabic">${z.ARABIC_TEXT || ''}</div>
      <div class="translation">${z.TRANSLATED_TEXT || ''}</div>
      ${z.AUDIO ? `<audio controls src="${z.AUDIO}"></audio>` : ''}
    `;
    content.appendChild(div);
  });
  document.querySelectorAll(".counter-btn").forEach(btn => {
    btn.addEventListener("click", () => {
      const id = btn.getAttribute("data-id");
      const span = document.getElementById("cnt-" + id);
      let val = parseInt(span.textContent);
      if (val > 0) val--;
      span.textContent = val;
      const store = JSON.parse(localStorage.getItem("salsabeela-adhkar") || "{}");
      store[id] = val;
      localStorage.setItem("salsabeela-adhkar", JSON.stringify(store));
    });
  });
}

searchBox.addEventListener("input", () => {
  const query = normalizeText(searchBox.value);
  suggestionBox.innerHTML = "";
  if (!query) { suggestionBox.style.display = "none"; renderSections(); return; }

  const matches = [];
  allData.forEach((sec, idx) => {
    const title = normalizeText(sec.TITLE);
    if (title.includes(query)) matches.push({ name: sec.TITLE, index: idx });
  });

  suggestionBox.innerHTML = "";
  matches.slice(0, 8).forEach(m => {
    const item = document.createElement("div");
    item.textContent = m.name;
    item.onclick = () => {
      suggestionBox.style.display = "none";
      searchBox.value = m.name;
      renderAdhkar(m.index);
    };
    suggestionBox.appendChild(item);
  });
  suggestionBox.style.display = matches.length ? "block" : "none";
});

searchBox.addEventListener("blur", () => setTimeout(() => suggestionBox.style.display = "none", 200));
loadAdhkar();
</script>
</body>
</html>
