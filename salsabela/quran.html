<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>سلسبيلا — المصحف</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Amiri&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    main {
      max-width: 850px;
      margin: auto;
      padding: 1rem;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      color: var(--primary, #2a9d8f);
    }
    .sura-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }
    .sura-item {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: 0.3s;
      cursor: pointer;
    }
    .sura-item:hover {
      background-color: var(--primary, #2a9d8f);
      color: #fff;
      transform: translateY(-3px);
    }
    .back-link {
      display: inline-block;
      margin-bottom: 10px;
      color: #2a9d8f;
      text-decoration: none;
      font-weight: 600;
    }
    .back-link:hover { text-decoration: underline; }
    input[type="search"] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-bottom: 15px;
      font-family: 'Cairo', sans-serif;
    }
  </style>
</head>
<body>

<div id="header-holder"></div>

<main>
  <h1>📖 فهرس سور القرآن الكريم</h1>

  <input type="search" id="search" placeholder="🔍 ابحث عن سورة..." oninput="filterSurahs()">

  <div class="sura-list" id="suraList"></div>
</main>

<div id="footer-holder"></div>
<script src="js/common.js"></script>
<script src="js/main.js"></script>

<script>
  const suraList = document.getElementById("suraList");
  const searchInput = document.getElementById("search");

  const surahNames = [
    "الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة","يونس",
    "هود","يوسف","الرعد","إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم","طه",
    "الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنكبوت","الروم",
    "لقمان","السجدة","الأحزاب","سبأ","فاطر","يس","الصافات","ص","الزمر","غافر",
    "فصلت","الشورى","الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق",
    "الذاريات","الطور","النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر","الممتحنة",
    "الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة","المعارج",
    "نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبأ","النازعات","عبس",
    "التكوير","الانفطار","المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد",
    "الشمس","الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة","العاديات",
    "القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر","الكافرون","النصر",
    "المسد","الإخلاص","الفلق","الناس"
  ];

  // 🔹 دالة تنقية النص العربي
  function normalizeArabic(text) {
    return text
      .toLowerCase()
      .replace(/[ًٌٍَُِّْـ]/g, "")
      .replace(/[أإآٱا]/g, "ا")
      .replace(/ؤ/g, "و")
      .replace(/ئ/g, "ي")
      .replace(/ة/g, "ه")
      .replace(/ى/g, "ي")
      .replace(/[^ءاأإآء-ي\s]/g, "");
  }

  // 🔹 تشابه بسيط بالحروف (Levenshtein distance)
  function similar(a, b) {
    if (!a || !b) return 0;
    const lenA = a.length, lenB = b.length;
    const dp = Array(lenA + 1).fill(null).map(() => Array(lenB + 1).fill(0));
    for (let i = 0; i <= lenA; i++) dp[i][0] = i;
    for (let j = 0; j <= lenB; j++) dp[0][j] = j;
    for (let i = 1; i <= lenA; i++) {
      for (let j = 1; j <= lenB; j++) {
        const cost = a[i - 1] === b[j - 1] ? 0 : 1;
        dp[i][j] = Math.min(
          dp[i - 1][j] + 1,
          dp[i][j - 1] + 1,
          dp[i - 1][j - 1] + cost
        );
      }
    }
    const dist = dp[lenA][lenB];
    return 1 - dist / Math.max(lenA, lenB);
  }

  // 🔹 عرض قائمة السور
  function renderSurahList(filtered = surahNames) {
    suraList.innerHTML = "";
    filtered.forEach(name => {
      const div = document.createElement("div");
      div.className = "sura-item";
      div.textContent = `${surahNames.indexOf(name) + 1}. ${name}`;
      div.onclick = () => window.location.href = `surah.html?id=${surahNames.indexOf(name) + 1}`;
      suraList.appendChild(div);
    });
    if (filtered.length === 0) {
      suraList.innerHTML = `<p style="grid-column: 1/-1; text-align:center; color:#777;">لا توجد سورة مطابقة 🔍</p>`;
    }
  }

  // 🔹 صندوق الاقتراحات
  const suggestionBox = document.createElement("div");
  suggestionBox.style.position = "absolute";
  suggestionBox.style.background = "#fff";
  suggestionBox.style.border = "1px solid #ccc";
  suggestionBox.style.borderRadius = "8px";
  suggestionBox.style.width = "calc(100% - 20px)";
  suggestionBox.style.padding = "5px 0";
  suggestionBox.style.textAlign = "right";
  suggestionBox.style.display = "none";
  suggestionBox.style.zIndex = "1000";
  suggestionBox.style.fontFamily = "'Cairo', sans-serif";
  suggestionBox.style.fontSize = "1rem";
  suggestionBox.style.boxShadow = "0 3px 6px rgba(0,0,0,0.1)";
  suggestionBox.style.maxHeight = "220px";
  suggestionBox.style.overflowY = "auto";
  suggestionBox.style.direction = "rtl";
  searchInput.parentNode.style.position = "relative";
  searchInput.parentNode.appendChild(suggestionBox);

  let currentFocus = -1;

  // 🔍 البحث الذكي + الاقتراحات
  function filterSurahs() {
    const val = normalizeArabic(searchInput.value.trim());
    suggestionBox.innerHTML = "";
    suggestionBox.style.display = "none";
    currentFocus = -1;

    if (!val) {
      renderSurahList();
      return;
    }

    const filtered = surahNames.filter(name => {
      const n = normalizeArabic(name);
      return n.includes(val) || similar(n, val) > 0.6;
    });

    renderSurahList(filtered);

    // 🔸 عرض الاقتراحات
    if (filtered.length > 0) {
      filtered.slice(0, 7).forEach(name => {
        const item = document.createElement("div");
        item.textContent = name;
        item.style.padding = "8px 12px";
        item.style.cursor = "pointer";
        item.onmouseover = () => highlight(item);
        item.onmouseout = () => unhighlight(item);
        item.onclick = () => {
          searchInput.value = name;
          suggestionBox.style.display = "none";
          renderSurahList([name]);
        };
        suggestionBox.appendChild(item);
      });
      suggestionBox.style.display = "block";
    }
  }

  // 🔹 تمييز العنصر المختار
  function highlight(item) { item.style.background = "#f0f0f0"; }
  function unhighlight(item) { item.style.background = "transparent"; }

  // 🔹 التنقل بلوحة المفاتيح
  searchInput.addEventListener("keydown", e => {
    let items = suggestionBox.querySelectorAll("div");
    if (!items.length) return;

    if (e.key === "ArrowDown") {
      currentFocus++;
      if (currentFocus >= items.length) currentFocus = 0;
      setActive(items);
    } else if (e.key === "ArrowUp") {
      currentFocus--;
      if (currentFocus < 0) currentFocus = items.length - 1;
      setActive(items);
    } else if (e.key === "Enter") {
      e.preventDefault();
      if (currentFocus > -1) {
        items[currentFocus].click();
      }
    }
  });

  function setActive(items) {
    items.forEach(i => (i.style.background = "transparent"));
    if (currentFocus >= 0) {
      items[currentFocus].style.background = "#e0f7f3";
      items[currentFocus].scrollIntoView({ block: "nearest" });
    }
  }

  // إخفاء الاقتراحات عند فقدان التركيز
  searchInput.addEventListener("blur", () => setTimeout(() => (suggestionBox.style.display = "none"), 150));

  renderSurahList();
</script>

</body>
</html>
