<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>سلسبيلا — المصحف</title>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&family=Amiri&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="favicon.png">
  <link rel="stylesheet" href="css/styles.css">
  <style>
    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f8faf9;
      margin: 0;
    }
    main {
      max-width: 850px;
      margin: auto;
      padding: 1rem;
      position: relative;
    }
    h1 {
      text-align: center;
      margin-bottom: 1rem;
      color: var(--primary, #2a9d8f);
    }
    .sura-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
    }
    .sura-item {
      background-color: #fff;
      border: 1px solid #ddd;
      border-radius: 10px;
      padding: 10px;
      text-align: center;
      transition: 0.3s;
      cursor: pointer;
    }
    .sura-item:hover {
      background-color: var(--primary, #2a9d8f);
      color: #fff;
      transform: translateY(-3px);
    }
    input[type="search"] {
      width: 100%;
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin-bottom: 5px;
      font-family: 'Cairo', sans-serif;
      font-size: 1rem;
    }
    .suggestion-box {
      position: absolute;
      background: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 5px 0;
      text-align: right;
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
      z-index: 9999;
      max-height: 220px;
      overflow-y: auto;
      direction: rtl;
      width: 100%;
      display: none;
    }
    .suggestion-box div {
      padding: 8px 12px;
      cursor: pointer;
    }
    .suggestion-box div:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>

<div id="header-holder"></div>

<main>
  <h1>📖 فهرس سور القرآن الكريم</h1>

  <div style="position: relative;">
    <input type="search" id="search" placeholder="🔍 ابحث عن سورة..." autocomplete="off">
    <div id="suggestionBox" class="suggestion-box"></div>
  </div>

  <div class="sura-list" id="suraList"></div>
</main>

<div id="footer-holder"></div>
<script src="js/common.js"></script>

<script>
  const suraList = document.getElementById("suraList");
  const searchInput = document.getElementById("search");
  const suggestionBox = document.getElementById("suggestionBox");

  const surahNames = [
    "الفاتحة","البقرة","آل عمران","النساء","المائدة","الأنعام","الأعراف","الأنفال","التوبة","يونس",
    "هود","يوسف","الرعد","إبراهيم","الحجر","النحل","الإسراء","الكهف","مريم","طه",
    "الأنبياء","الحج","المؤمنون","النور","الفرقان","الشعراء","النمل","القصص","العنكبوت","الروم",
    "لقمان","السجدة","الأحزاب","سبأ","فاطر","يس","الصافات","ص","الزمر","غافر",
    "فصلت","الشورى","الزخرف","الدخان","الجاثية","الأحقاف","محمد","الفتح","الحجرات","ق",
    "الذاريات","الطور","النجم","القمر","الرحمن","الواقعة","الحديد","المجادلة","الحشر","الممتحنة",
    "الصف","الجمعة","المنافقون","التغابن","الطلاق","التحريم","الملك","القلم","الحاقة","المعارج",
    "نوح","الجن","المزمل","المدثر","القيامة","الإنسان","المرسلات","النبأ","النازعات","عبس",
    "التكوير","الانفطار","المطففين","الانشقاق","البروج","الطارق","الأعلى","الغاشية","الفجر","البلد",
    "الشمس","الليل","الضحى","الشرح","التين","العلق","القدر","البينة","الزلزلة","العاديات",
    "القارعة","التكاثر","العصر","الهمزة","الفيل","قريش","الماعون","الكوثر","الكافرون","النصر",
    "المسد","الإخلاص","الفلق","الناس"
  ];

  function normalizeArabic(text) {
    return text.toLowerCase()
      .replace(/[ًٌٍَُِّْـ]/g, "")
      .replace(/[أإآٱا]/g, "ا")
      .replace(/ؤ/g, "و")
      .replace(/ئ/g, "ي")
      .replace(/ة/g, "ه")
      .replace(/ى/g, "ي")
      .replace(/[^ءاأإآء-ي\s]/g, "");
  }

  function similar(a, b) {
    if (!a || !b) return 0;
    const lenA = a.length, lenB = b.length;
    const dp = Array(lenA + 1).fill().map(() => Array(lenB + 1).fill(0));
    for (let i = 0; i <= lenA; i++) dp[i][0] = i;
    for (let j = 0; j <= lenB; j++) dp[0][j] = j;
    for (let i = 1; i <= lenA; i++) {
      for (let j = 1; j <= lenB; j++) {
        const cost = a[i - 1] === b[j - 1] ? 0 : 1;
        dp[i][j] = Math.min(
          dp[i - 1][j] + 1,
          dp[i][j - 1] + 1,
          dp[i - 1][j - 1] + cost
        );
      }
    }
    const dist = dp[lenA][lenB];
    return 1 - dist / Math.max(lenA, lenB);
  }

  function renderSurahList(filtered = surahNames) {
    suraList.innerHTML = "";
    filtered.forEach(name => {
      const div = document.createElement("div");
      div.className = "sura-item";
      div.textContent = `${surahNames.indexOf(name) + 1}. ${name}`;
      div.onclick = () => window.location.href = `surah.html?id=${surahNames.indexOf(name) + 1}`;
      suraList.appendChild(div);
    });
    if (filtered.length === 0)
      suraList.innerHTML = `<p style="grid-column: 1/-1; text-align:center; color:#777;">لا توجد سورة مطابقة 🔍</p>`;
  }

  function filterSurahs() {
    const val = normalizeArabic(searchInput.value.trim());
    suggestionBox.innerHTML = "";
    suggestionBox.style.display = "none";

    if (!val) { renderSurahList(); return; }

    const filtered = surahNames.filter(name => {
      const n = normalizeArabic(name);
      return n.includes(val) || similar(n, val) > 0.65;
    });

    renderSurahList(filtered);

    if (filtered.length > 0) {
      filtered.slice(0, 6).forEach(name => {
        const item = document.createElement("div");
        item.textContent = name;
        item.onclick = () => {
          const index = surahNames.indexOf(name) + 1;
          window.location.href = `surah.html?id=${index}`;
        };
        suggestionBox.appendChild(item);
      });
      suggestionBox.style.display = "block";
    }
  }

  searchInput.addEventListener("input", filterSurahs);
  searchInput.addEventListener("focus", filterSurahs);
  searchInput.addEventListener("blur", () => {
    setTimeout(() => suggestionBox.style.display = "none", 200);
  });

  renderSurahList();
</script>

</body>
</html>
